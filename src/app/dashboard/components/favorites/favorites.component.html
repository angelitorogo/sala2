<!-- src/app/features/user/pages/favorites/favorites.component.html -->

<div class="page">

  <!-- LOADER GLOBAL -->
  <ng-container *ngIf="loading; else content">
    <div class="loading-screen">
      <div class="spinner"></div>
      <div>Cargando tus colecciones…</div>
    </div>
  </ng-container>

  <ng-template #content>

    <!-- CABECERA -->
    <header class="page__header">
      <div class="brand">
        <img
          src="assets/images/sala2.png"
          alt="SALA 2"
          class="brand__icon"
        />
        <div class="brand__text">
          <h1>Tus colecciones</h1>
          <p>Películas favoritas y series que sigues</p>
        </div>
      </div>
    </header>

    <!-- ========== PELÍCULAS FAVORITAS ========== -->
    <section class="block">
      <div class="block__header">
        <h2>Películas favoritas</h2>
        <span class="block__count" *ngIf="movies.length">
          {{ movies.length }} elemento{{ movies.length === 1 ? '' : 's' }}
        </span>
      </div>

      <ng-container *ngIf="movies.length; else noMovies">
        <div class="grid">
          <article
            class="card"
            *ngFor="let m of movies; trackBy: trackByMovie"
            [attr.aria-label]="m.title"
            (click)="openMovie(m.movieId!)"
          >
            <div class="card__media">
              <img
                [src]="posterUrl(m.posterPath)"
                [alt]="m.title"
                loading="lazy"
              />


              <span
                class="rating"
                *ngIf="m.voteAverage != null && m.voteAverage !== undefined"
              >
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                  ></path>
                </svg>
                {{ m.voteAverage | number: '1.1-1' }}
              </span>
            </div>

            <div class="card__body">
              <h3 class="card__title">
                {{ m.title }}
              </h3>
              <!-- Sin fecha, como pediste -->
            </div>
          </article>
        </div>
      </ng-container>

      <ng-template #noMovies>
        <div class="state">
          Aún no has marcado ninguna película como favorita.
        </div>
      </ng-template>
    </section>

    <!-- ========== SERIES SEGUIDAS ========== -->
    <section class="block">
      <div class="block__header">
        <h2>Series que sigues</h2>
        <span class="block__count" *ngIf="series.length">
          {{ series.length }} serie{{ series.length === 1 ? '' : 's' }}
        </span>
      </div>

      <ng-container *ngIf="series.length; else noSeries">
        <div class="grid">
          <article
            class="card"
            *ngFor="let s of series; trackBy: trackBySerie"
            [attr.aria-label]="s.name"
            (click)="openSerie(s.tvId!)"
          >
            <div class="card__media">
              <img
                [src]="posterUrl(s.posterPath)"
                [alt]="s.name"
                loading="lazy"
              />

              <span
                class="rating"
                *ngIf="s.voteAverage != null && s.voteAverage !== undefined"
              >
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                  ></path>
                </svg>
                {{ s.voteAverage | number: '1.1-1' }}
              </span>
            </div>

            <div class="card__body">
              <h3 class="card__title">
                {{ s.name }}
              </h3>
              <!-- Sin fecha -->
            </div>
          </article>
        </div>
      </ng-container>

      <ng-template #noSeries>
        <div class="state">
          Todavía no sigues ninguna serie.
        </div>
      </ng-template>
    </section>

  </ng-template>
</div>
